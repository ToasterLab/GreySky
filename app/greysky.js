// Generated by CoffeeScript 1.11.1
(function() {
  var GreySky, app, parseXML;

  parseXML = function(xml) {
    var parseXml;
    if (window.DOMParser != null) {
      parseXML = function(xmlStr) {
        return (new window.DOMParser()).parseFromString(xmlStr, "text/xml");
      };
      return parseXML(xml);
    } else if ((window.ActiveXObject != null) && new window.ActiveXObject("Microsoft.XMLDOM")) {
      return parseXml = function(xmlStr) {
        var xmlDoc;
        xmlDoc = new window.ActiveXObject("Microsoft.XMLDOM");
        xmlDoc.async = "false";
        xmlDoc.loadXML(xmlStr);
        return xmlDoc;
      };
    } else {
      throw new Error("No XML parser found");
    }
  };

  GreySky = (function() {
    function GreySky(key) {
      this.key = key;
    }

    GreySky.prototype.willItHaze = function() {
      var getBackToMe, xhr;
      getBackToMe = (function(_this) {
        return function() {
          if (xhr.status === 200 && (xhr.responseText != null)) {
            _this.psi = xhr.responseText;
            return _this.drawHaze(_this.psi);
          } else if (xhr.status !== 200) {
            return alert("why: " + xhr.status);
          }
        };
      })(this);
      xhr = new XMLHttpRequest();
      xhr.open("GET", "http://api.nea.gov.sg/api/WebAPI/?dataset=psi_update&keyref=" + this.key);
      xhr.addEventListener("load", getBackToMe);
      xhr.send();
      return this.psi;
    };

    GreySky.prototype.drawHaze = function(psi) {
      var data, hazeData, i, j, len, len1, place, r, reading, readings, record, regions;
      data = parseXML(psi);
      regions = data.getElementsByTagName("region");
      hazeData = [];
      for (i = 0, len = regions.length; i < len; i++) {
        place = regions[i];
        record = place.getElementsByTagName("record")[0];
        r = {
          name: place.getElementsByTagName("id")[0].textContent,
          timestamp: record.getAttribute("timestamp"),
          readings: []
        };
        readings = record.getElementsByTagName("reading");
        for (j = 0, len1 = readings.length; j < len1; j++) {
          reading = readings[j];
          r.readings[reading.getAttribute("type")] = reading.getAttribute("value");
        }
        hazeData.push(r);
      }
      console.log(hazeData);
      return hazeData;
    };

    return GreySky;

  })();

  app = new GreySky("781CF461BB6606AD28A78E343E0E41768209B2EF144E6564");

  console.log(app.willItHaze());

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JleXNreS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImdyZXlza3kuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFHQTtBQUFBLE1BQUE7O0VBQUEsUUFBQSxHQUFXLFNBQUMsR0FBRDtBQUNWLFFBQUE7SUFBQSxJQUFHLHdCQUFIO01BQ0MsUUFBQSxHQUFXLFNBQUMsTUFBRDtlQUNWLENBQUssSUFBQSxNQUFNLENBQUMsU0FBUCxDQUFBLENBQUwsQ0FBd0IsQ0FBQyxlQUF6QixDQUF5QyxNQUF6QyxFQUFpRCxVQUFqRDtNQURVO2FBRVgsUUFBQSxDQUFTLEdBQVQsRUFIRDtLQUFBLE1BSUssSUFBRyw4QkFBQSxJQUE2QixJQUFBLE1BQU0sQ0FBQyxhQUFQLENBQXFCLGtCQUFyQixDQUFoQzthQUNKLFFBQUEsR0FBVyxTQUFDLE1BQUQ7QUFDVixZQUFBO1FBQUEsTUFBQSxHQUFhLElBQUEsTUFBTSxDQUFDLGFBQVAsQ0FBcUIsa0JBQXJCO1FBQ2IsTUFBTSxDQUFDLEtBQVAsR0FBZTtRQUNmLE1BQU0sQ0FBQyxPQUFQLENBQWUsTUFBZjtBQUNBLGVBQU87TUFKRyxFQURQO0tBQUEsTUFBQTtBQU9KLFlBQVUsSUFBQSxLQUFBLENBQU0scUJBQU4sRUFQTjs7RUFMSzs7RUFjTDtJQUNRLGlCQUFDLEdBQUQ7TUFBQyxJQUFDLENBQUEsTUFBRDtJQUFEOztzQkFDYixVQUFBLEdBQVksU0FBQTtBQUNYLFVBQUE7TUFBQSxXQUFBLEdBQWMsQ0FBQSxTQUFBLEtBQUE7ZUFBQSxTQUFBO1VBQ2IsSUFBRyxHQUFHLENBQUMsTUFBSixLQUFjLEdBQWQsSUFBc0IsMEJBQXpCO1lBQ0MsS0FBQyxDQUFBLEdBQUQsR0FBTyxHQUFHLENBQUM7bUJBQ1gsS0FBQyxDQUFBLFFBQUQsQ0FBVSxLQUFDLENBQUEsR0FBWCxFQUZEO1dBQUEsTUFHSyxJQUFHLEdBQUcsQ0FBQyxNQUFKLEtBQWMsR0FBakI7bUJBQ0osS0FBQSxDQUFNLE9BQUEsR0FBUSxHQUFHLENBQUMsTUFBbEIsRUFESTs7UUFKUTtNQUFBLENBQUEsQ0FBQSxDQUFBLElBQUE7TUFNZCxHQUFBLEdBQVUsSUFBQSxjQUFBLENBQUE7TUFDVixHQUFHLENBQUMsSUFBSixDQUFTLEtBQVQsRUFBZSw4REFBQSxHQUErRCxJQUFDLENBQUEsR0FBL0U7TUFDQSxHQUFHLENBQUMsZ0JBQUosQ0FBcUIsTUFBckIsRUFBNkIsV0FBN0I7TUFDQSxHQUFHLENBQUMsSUFBSixDQUFBO0FBQ0EsYUFBTyxJQUFDLENBQUE7SUFYRzs7c0JBWVosUUFBQSxHQUFVLFNBQUMsR0FBRDtBQUNULFVBQUE7TUFBQSxJQUFBLEdBQU8sUUFBQSxDQUFTLEdBQVQ7TUFDUCxPQUFBLEdBQVUsSUFBSSxDQUFDLG9CQUFMLENBQTBCLFFBQTFCO01BQ1YsUUFBQSxHQUFXO0FBQ1gsV0FBQSx5Q0FBQTs7UUFDQyxNQUFBLEdBQVMsS0FBSyxDQUFDLG9CQUFOLENBQTJCLFFBQTNCLENBQXFDLENBQUEsQ0FBQTtRQUM5QyxDQUFBLEdBQ0M7VUFBQSxJQUFBLEVBQU0sS0FBSyxDQUFDLG9CQUFOLENBQTJCLElBQTNCLENBQWlDLENBQUEsQ0FBQSxDQUFFLENBQUMsV0FBMUM7VUFDQSxTQUFBLEVBQVcsTUFBTSxDQUFDLFlBQVAsQ0FBb0IsV0FBcEIsQ0FEWDtVQUVBLFFBQUEsRUFBVSxFQUZWOztRQUdELFFBQUEsR0FBVyxNQUFNLENBQUMsb0JBQVAsQ0FBNEIsU0FBNUI7QUFDWCxhQUFBLDRDQUFBOztVQUNDLENBQUMsQ0FBQyxRQUFTLENBQUEsT0FBTyxDQUFDLFlBQVIsQ0FBcUIsTUFBckIsQ0FBQSxDQUFYLEdBQTJDLE9BQU8sQ0FBQyxZQUFSLENBQXFCLE9BQXJCO0FBRDVDO1FBRUEsUUFBUSxDQUFDLElBQVQsQ0FBYyxDQUFkO0FBVEQ7TUFVQSxPQUFPLENBQUMsR0FBUixDQUFZLFFBQVo7QUFDQSxhQUFPO0lBZkU7Ozs7OztFQWtCWCxHQUFBLEdBQVUsSUFBQSxPQUFBLENBQVEsa0RBQVI7O0VBQ1YsT0FBTyxDQUFDLEdBQVIsQ0FBWSxHQUFHLENBQUMsVUFBSixDQUFBLENBQVo7QUEvQ0EiLCJzb3VyY2VzQ29udGVudCI6WyIjIGh0dHA6Ly9hcGkubmVhLmdvdi5zZy9hcGkvV2ViQVBJLz9kYXRhc2V0PXBtMi41X3VwZGF0ZSZrZXlyZWY9NzgxQ0Y0NjFCQjY2MDZBRDI4QTc4RTM0M0UwRTQxNzY4MjA5QjJFRjE0NEU2NTY0XG5cblxucGFyc2VYTUwgPSAoeG1sKSAtPlxuXHRpZiB3aW5kb3cuRE9NUGFyc2VyP1xuXHRcdHBhcnNlWE1MID0gKHhtbFN0cikgLT5cblx0XHRcdChuZXcgd2luZG93LkRPTVBhcnNlcigpKS5wYXJzZUZyb21TdHJpbmcoeG1sU3RyLCBcInRleHQveG1sXCIpXG5cdFx0cGFyc2VYTUwoeG1sKVxuXHRlbHNlIGlmIHdpbmRvdy5BY3RpdmVYT2JqZWN0PyAmJiBuZXcgd2luZG93LkFjdGl2ZVhPYmplY3QoXCJNaWNyb3NvZnQuWE1MRE9NXCIpXG5cdFx0cGFyc2VYbWwgPSAoeG1sU3RyKSAtPlxuXHRcdFx0eG1sRG9jID0gbmV3IHdpbmRvdy5BY3RpdmVYT2JqZWN0IFwiTWljcm9zb2Z0LlhNTERPTVwiXG5cdFx0XHR4bWxEb2MuYXN5bmMgPSBcImZhbHNlXCJcblx0XHRcdHhtbERvYy5sb2FkWE1MIHhtbFN0clxuXHRcdFx0cmV0dXJuIHhtbERvY1xuXHRlbHNlXG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiTm8gWE1MIHBhcnNlciBmb3VuZFwiKVxuXHRcbmNsYXNzIEdyZXlTa3lcblx0Y29uc3RydWN0b3I6IChAa2V5KSAtPlxuXHR3aWxsSXRIYXplOiAoKSAtPlxuXHRcdGdldEJhY2tUb01lID0gKCkgPT5cblx0XHRcdGlmIHhoci5zdGF0dXMgPT0gMjAwIGFuZCB4aHIucmVzcG9uc2VUZXh0P1xuXHRcdFx0XHRAcHNpID0geGhyLnJlc3BvbnNlVGV4dFxuXHRcdFx0XHRAZHJhd0hhemUgQHBzaVxuXHRcdFx0ZWxzZSBpZiB4aHIuc3RhdHVzICE9IDIwMFxuXHRcdFx0XHRhbGVydCBcIndoeTogXCIreGhyLnN0YXR1c1xuXHRcdHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXHRcdHhoci5vcGVuKFwiR0VUXCIsXCJodHRwOi8vYXBpLm5lYS5nb3Yuc2cvYXBpL1dlYkFQSS8/ZGF0YXNldD1wc2lfdXBkYXRlJmtleXJlZj1cIitAa2V5KVxuXHRcdHhoci5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBnZXRCYWNrVG9NZSk7XG5cdFx0eGhyLnNlbmQoKTtcblx0XHRyZXR1cm4gQHBzaVxuXHRkcmF3SGF6ZTogKHBzaSktPlxuXHRcdGRhdGEgPSBwYXJzZVhNTChwc2kpXG5cdFx0cmVnaW9ucyA9IGRhdGEuZ2V0RWxlbWVudHNCeVRhZ05hbWUgXCJyZWdpb25cIlxuXHRcdGhhemVEYXRhID0gW11cblx0XHRmb3IgcGxhY2UgaW4gcmVnaW9uc1xuXHRcdFx0cmVjb3JkID0gcGxhY2UuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJyZWNvcmRcIilbMF1cblx0XHRcdHIgPVxuXHRcdFx0XHRuYW1lOiBwbGFjZS5nZXRFbGVtZW50c0J5VGFnTmFtZShcImlkXCIpWzBdLnRleHRDb250ZW50XG5cdFx0XHRcdHRpbWVzdGFtcDogcmVjb3JkLmdldEF0dHJpYnV0ZShcInRpbWVzdGFtcFwiKVxuXHRcdFx0XHRyZWFkaW5nczogW11cblx0XHRcdHJlYWRpbmdzID0gcmVjb3JkLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwicmVhZGluZ1wiKVxuXHRcdFx0Zm9yIHJlYWRpbmcgaW4gcmVhZGluZ3Ncblx0XHRcdFx0ci5yZWFkaW5nc1tyZWFkaW5nLmdldEF0dHJpYnV0ZShcInR5cGVcIildID0gcmVhZGluZy5nZXRBdHRyaWJ1dGUoXCJ2YWx1ZVwiKVxuXHRcdFx0aGF6ZURhdGEucHVzaChyKVxuXHRcdGNvbnNvbGUubG9nIGhhemVEYXRhXG5cdFx0cmV0dXJuIGhhemVEYXRhXG5cdFx0XG5cbmFwcCA9IG5ldyBHcmV5U2t5IFwiNzgxQ0Y0NjFCQjY2MDZBRDI4QTc4RTM0M0UwRTQxNzY4MjA5QjJFRjE0NEU2NTY0XCJcbmNvbnNvbGUubG9nIGFwcC53aWxsSXRIYXplKCkiXX0=
//# sourceURL=/home/huey/Downloads/GreySky/greysky.coffee